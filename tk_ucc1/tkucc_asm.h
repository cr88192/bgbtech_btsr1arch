#define TKUCC_NMID_MOVB			0x0001
#define TKUCC_NMID_MOVW			0x0002
#define TKUCC_NMID_MOVL			0x0003
#define TKUCC_NMID_MOVQ			0x0004
#define TKUCC_NMID_MOVUB		0x0005
#define TKUCC_NMID_MOVUW		0x0006
#define TKUCC_NMID_MOVUL		0x0007
#define TKUCC_NMID_MOVX			0x0008
#define TKUCC_NMID_ADD			0x0009
#define TKUCC_NMID_SUB			0x000A
#define TKUCC_NMID_ADDC			0x000B
#define TKUCC_NMID_SUBC			0x000C
#define TKUCC_NMID_TST			0x000D
#define TKUCC_NMID_AND			0x000E
#define TKUCC_NMID_OR			0x000F
#define TKUCC_NMID_XOR			0x0010
#define TKUCC_NMID_MOV			0x0011
#define TKUCC_NMID_CMPEQ		0x0012
#define TKUCC_NMID_CMPHI		0x0013
#define TKUCC_NMID_CMPGT		0x0014
#define TKUCC_NMID_DMULU		0x0015
#define TKUCC_NMID_BRA			0x0016
#define TKUCC_NMID_BSR			0x0017
#define TKUCC_NMID_BT			0x0018
#define TKUCC_NMID_BF			0x0019
#define TKUCC_NMID_LDIZ			0x001A
#define TKUCC_NMID_LDIN			0x001B
#define TKUCC_NMID_LDSH8		0x001C
#define TKUCC_NMID_CMPGE		0x001D
#define TKUCC_NMID_NOP			0x001E
#define TKUCC_NMID_RTS			0x001F
#define TKUCC_NMID_SLEEP		0x0020
#define TKUCC_NMID_BRK			0x0021
#define TKUCC_NMID_CLRT			0x0022
#define TKUCC_NMID_SETT			0x0023
#define TKUCC_NMID_CLRS			0x0024
#define TKUCC_NMID_SETS			0x0025
#define TKUCC_NMID_NOTT			0x0026
#define TKUCC_NMID_NOTS			0x0027
#define TKUCC_NMID_RTE			0x0028
#define TKUCC_NMID_LDTLB		0x0029
#define TKUCC_NMID_RTSU			0x002A
#define TKUCC_NMID_SYSCALL		0x002B
#define TKUCC_NMID_LDACL		0x002C
#define TKUCC_NMID_SVEKRR		0x002D
#define TKUCC_NMID_LDEKRR		0x002E
#define TKUCC_NMID_LDEKEY		0x002F

#define TKUCC_NMID_LDEENC		0x0030
#define TKUCC_NMID_INVTLB		0x0031
#define TKUCC_NMID_INVIC		0x0032
#define TKUCC_NMID_INVDC		0x0033
#define TKUCC_NMID_JMP			0x0034
#define TKUCC_NMID_JSR			0x0035
#define TKUCC_NMID_BTS			0x0036
#define TKUCC_NMID_BFS			0x0037
#define TKUCC_NMID_EXTUB		0x0038
#define TKUCC_NMID_EXTUW		0x0039
#define TKUCC_NMID_EXTSB		0x003A
#define TKUCC_NMID_EXTSW		0x003B
#define TKUCC_NMID_LEAB			0x003C
#define TKUCC_NMID_LEAW			0x003D
#define TKUCC_NMID_LEAL			0x003E
#define TKUCC_NMID_LEAQ			0x003F

#define TKUCC_NMID_NOT			0x0040
#define TKUCC_NMID_NEG			0x0041
#define TKUCC_NMID_NEGC			0x0042
#define TKUCC_NMID_MOVNT		0x0043
#define TKUCC_NMID_SHAD			0x0044
#define TKUCC_NMID_SHLD			0x0045
#define TKUCC_NMID_SHADQ		0x0046
#define TKUCC_NMID_SHLDQ		0x0047
#define TKUCC_NMID_EXTUL		0x0048
#define TKUCC_NMID_EXTSL		0x0049
#define TKUCC_NMID_TRAPA		0x004A
#define TKUCC_NMID_WEXMD		0x004B
#define TKUCC_NMID_CPUID		0x004C
#define TKUCC_NMID_CMPHS		0x004D
#define TKUCC_NMID_LDC			0x004E
#define TKUCC_NMID_STC			0x004F
#define TKUCC_NMID_LDS			0x0050
#define TKUCC_NMID_STS			0x0051
#define TKUCC_NMID_MOVT			0x0052
#define TKUCC_NMID_TSTQ			0x0053
#define TKUCC_NMID_CMPQEQ		0x0054
#define TKUCC_NMID_DMULS		0x0055
#define TKUCC_NMID_CMPQHI		0x0056
#define TKUCC_NMID_CMPQGT		0x0057
#define TKUCC_NMID_FCMPEQ		0x0058
#define TKUCC_NMID_FCMPGT		0x0059
#define TKUCC_NMID_FADD			0x005A
#define TKUCC_NMID_FSUB			0x005B
#define TKUCC_NMID_FMUL			0x005C
#define TKUCC_NMID_LDTEX		0x005D
#define TKUCC_NMID_FLDCF		0x005E
#define TKUCC_NMID_FSTCF		0x005F

#define TKUCC_NMID_ADDX			0x0060
#define TKUCC_NMID_SUBX			0x0061
#define TKUCC_NMID_TSTX			0x0062
#define TKUCC_NMID_XMOV			0x0063
#define TKUCC_NMID_CMPQGE		0x0064
#define TKUCC_NMID_ANDX			0x0065
#define TKUCC_NMID_ORX			0x0066
#define TKUCC_NMID_XORX			0x0067
#define TKUCC_NMID_MULSQ		0x0068
#define TKUCC_NMID_MULUQ		0x0069
#define TKUCC_NMID_ADDL			0x006A
#define TKUCC_NMID_SUBL			0x006B
#define TKUCC_NMID_ADDSL		0x006C
#define TKUCC_NMID_SUBSL		0x006D
#define TKUCC_NMID_ADDUL		0x006E
#define TKUCC_NMID_SUBUL		0x006F

#define TKUCC_NMID_BNDCHKB		0x0070
#define TKUCC_NMID_BNDCHKW		0x0071
#define TKUCC_NMID_BNDCHKL		0x0072
#define TKUCC_NMID_BNDCHKQ		0x0073
#define TKUCC_NMID_BNDCHK		0x0074
#define TKUCC_NMID_BNDCMP		0x0075
#define TKUCC_NMID_MULUX		0x0076
#define TKUCC_NMID_MULHUX		0x0077
#define TKUCC_NMID_DIVUX		0x0078
#define TKUCC_NMID_MODUX		0x0079
#define TKUCC_NMID_VSKG			0x007A
#define TKUCC_NMID_VSKC			0x007B
#define TKUCC_NMID_BCDADC		0x007C
#define TKUCC_NMID_BCDSBB		0x007D
#define TKUCC_NMID_MOVZT		0x007E
#define TKUCC_NMID_XMOVZT		0x007F

#define TKUCC_NMID_SNIPEDC		0x0080
#define TKUCC_NMID_SNIPEIC		0x0081
#define TKUCC_NMID_CMPTAEQ		0x0082
#define TKUCC_NMID_CMPXEQ		0x0083
#define TKUCC_NMID_CMPTAHI		0x0084
#define TKUCC_NMID_CMPXHI		0x0085
#define TKUCC_NMID_CMPTAHS		0x0086
#define TKUCC_NMID_CMPXGT		0x0087
#define TKUCC_NMID_CONVFXI		0x0088
#define TKUCC_NMID_CONVFLI		0x0089
#define TKUCC_NMID_CMPNANTTEQ	0x008A
#define TKUCC_NMID_SETTRAP		0x008B
#define TKUCC_NMID_CMPTTEQ		0x008C
#define TKUCC_NMID_CMPQHS		0x008D
#define TKUCC_NMID_BTRNS		0x008E
#define TKUCC_NMID_BTRNSQ		0x008F

#define TKUCC_NMID_CLZ			0x0090
#define TKUCC_NMID_CLZQ			0x0091
#define TKUCC_NMID_CTZ			0x0092
#define TKUCC_NMID_CTZQ			0x0093
#define TKUCC_NMID_FNEG			0x0094
#define TKUCC_NMID_FLDCDX		0x0095
#define TKUCC_NMID_FLDCFH		0x0096
#define TKUCC_NMID_FLDCI		0x0097
#define TKUCC_NMID_FLDCH		0x0098
#define TKUCC_NMID_FABS			0x0099
#define TKUCC_NMID_FSTCDX		0x009A
#define TKUCC_NMID_FSTCI		0x009B
#define TKUCC_NMID_FSTCH		0x009C
#define TKUCC_NMID_FCMPXEQ		0x009D
#define TKUCC_NMID_FCMPXGT		0x009E
#define TKUCC_NMID_FSQRT		0x009F

#define TKUCC_NMID_RGB5PCK32	0x00A0
#define TKUCC_NMID_RGB5PCK64	0x00A1
#define TKUCC_NMID_RGB5UPCK32	0x00A2
#define TKUCC_NMID_RGB5UPCK64	0x00A3
#define TKUCC_NMID_RGB32PCK64	0x00A4
#define TKUCC_NMID_RGB32UPCK64	0x00A5
#define TKUCC_NMID_PLDCM8SH		0x00A6
#define TKUCC_NMID_PLDCM8UH		0x00A7
#define TKUCC_NMID_PSTCM8SH		0x00A8
#define TKUCC_NMID_PSTCM8UH		0x00A9
#define TKUCC_NMID_PLDCH		0x00AA
#define TKUCC_NMID_PLDCHH		0x00AB
#define TKUCC_NMID_PLDCEHL		0x00AC
#define TKUCC_NMID_PLDCEHH		0x00AD
#define TKUCC_NMID_PSTCH		0x00AE
#define TKUCC_NMID_RGB5SHR1		0x00AF

#define TKUCC_NMID_PMORTL		0x00B0
#define TKUCC_NMID_PMORTQ		0x00B1
#define TKUCC_NMID_PADDW		0x00B2
#define TKUCC_NMID_PADDL		0x00B3
#define TKUCC_NMID_PSUBW		0x00B4
#define TKUCC_NMID_PSUBL		0x00B5
#define TKUCC_NMID_SHAR			0x00B6
#define TKUCC_NMID_SHARQ		0x00B7
#define TKUCC_NMID_SHLR			0x00B8
#define TKUCC_NMID_SHLRQ		0x00B9
#define TKUCC_NMID_PCSELTW		0x00BA
#define TKUCC_NMID_PCSELTL		0x00BB
#define TKUCC_NMID_PADDF		0x00BC
#define TKUCC_NMID_PADDFX		0x00BD
#define TKUCC_NMID_PSUBF		0x00BE
#define TKUCC_NMID_PSUBFX		0x00BF

#define TKUCC_NMID_PMULF		0x00C0
#define TKUCC_NMID_PMULFX		0x00C1
#define TKUCC_NMID_MOVHD		0x00C2
#define TKUCC_NMID_MOVLD		0x00C3
#define TKUCC_NMID_MOVHLD		0x00C4
#define TKUCC_NMID_MOVLHD		0x00C5
#define TKUCC_NMID_PSCHEQW		0x00C6
#define TKUCC_NMID_PSCHEQB		0x00C7
#define TKUCC_NMID_PSCHNEW		0x00C8
#define TKUCC_NMID_PSCHNEB		0x00C9
#define TKUCC_NMID_BLKUTX1		0x00CA
#define TKUCC_NMID_BLKUTX2		0x00CB
#define TKUCC_NMID_PADDH		0x00CC
#define TKUCC_NMID_PADDXD		0x00CD
#define TKUCC_NMID_PSUBH		0x00CE
#define TKUCC_NMID_PSUBXD		0x00CF

#define TKUCC_NMID_PMULH		0x00D0
#define TKUCC_NMID_PMULXD		0x00D1
#define TKUCC_NMID_ROTL			0x00D2
#define TKUCC_NMID_ROTR			0x00D3
#define TKUCC_NMID_ROTCL		0x00D4
#define TKUCC_NMID_ROTCR		0x00D5
#define TKUCC_NMID_MOVTT		0x00D6
#define TKUCC_NMID_SHARX		0x00D7
#define TKUCC_NMID_SHLRX		0x00D8
#define TKUCC_NMID_SHADX		0x00D9
#define TKUCC_NMID_MULHSQ		0x00DA
#define TKUCC_NMID_MULHUQ		0x00DB
#define TKUCC_NMID_SHLDX		0x00DC
#define TKUCC_NMID_ROTLX		0x00DD
#define TKUCC_NMID_MOVC			0x00DE
#define TKUCC_NMID_CSELT		0x00DF

#define TKUCC_NMID_LEATB		0x00E0
#define TKUCC_NMID_LEATW		0x00E1
#define TKUCC_NMID_LEATL		0x00E2
#define TKUCC_NMID_LEATQ		0x00E3
#define TKUCC_NMID_FMOVS		0x00E4
#define TKUCC_NMID_FMOVH		0x00E5
#define TKUCC_NMID_FADDA		0x00E6
#define TKUCC_NMID_FSUBA		0x00E7
#define TKUCC_NMID_FMULA		0x00E8
#define TKUCC_NMID_FDIV			0x00E9
#define TKUCC_NMID_FMAC			0x00EA
#define TKUCC_NMID_FMACX		0x00EB
#define TKUCC_NMID_FADDX		0x00EC
#define TKUCC_NMID_FSUBX		0x00ED
#define TKUCC_NMID_FMULX		0x00EE
#define TKUCC_NMID_FDIVX		0x00EF

#define TKUCC_NMID_PMULSW		0x00F0
#define TKUCC_NMID_PMULUW		0x00F1
#define TKUCC_NMID_MULSL		0x00F2
#define TKUCC_NMID_MULUL		0x00F3
#define TKUCC_NMID_MACSL		0x00F4
#define TKUCC_NMID_MACUL		0x00F5
#define TKUCC_NMID_DMACSL		0x00F6
#define TKUCC_NMID_DMACUL		0x00F7
#define TKUCC_NMID_DIVSQ		0x00F8
#define TKUCC_NMID_DIVUQ		0x00F9
#define TKUCC_NMID_MODSQ		0x00FA
#define TKUCC_NMID_MODUQ		0x00FB
#define TKUCC_NMID_DIVSL		0x00FC
#define TKUCC_NMID_DIVUL		0x00FD
#define TKUCC_NMID_MODSL		0x00FE
#define TKUCC_NMID_MODUL		0x00FF

#define TKUCC_NMID_PMULSLW		0x0100
#define TKUCC_NMID_PMULULW		0x0101
#define TKUCC_NMID_PMULSHW		0x0102
#define TKUCC_NMID_PMULUHW		0x0103
#define TKUCC_NMID_BLKUTX3H		0x0104
#define TKUCC_NMID_BLKUTX3L		0x0105
#define TKUCC_NMID_BLINTW		0x0106
#define TKUCC_NMID_BLINTAW		0x0107
#define TKUCC_NMID_BITSEL		0x0108
#define TKUCC_NMID_BITSELX		0x0109
#define TKUCC_NMID_BLKUAB1		0x010A
#define TKUCC_NMID_BLKUAB2		0x010B
#define TKUCC_NMID_RSUB			0x010C
#define TKUCC_NMID_FADDG		0x010D
#define TKUCC_NMID_FSUBG		0x010E
#define TKUCC_NMID_FMULG		0x010F

#define TKUCC_NMID_PSHUFB		0x0110
#define TKUCC_NMID_PSHUFW		0x0111
#define TKUCC_NMID_LDIHI		0x0112
#define TKUCC_NMID_LDIHIQ		0x0113
#define TKUCC_NMID_MULSW		0x0114
#define TKUCC_NMID_MULUW		0x0115
#define TKUCC_NMID_XLEAB		0x0116
#define TKUCC_NMID_LDSH16		0x0117
#define TKUCC_NMID_BREQL		0x0118
#define TKUCC_NMID_BREQ			0x0119
#define TKUCC_NMID_BRNEL		0x011A
#define TKUCC_NMID_BRNE			0x011B
#define TKUCC_NMID_BRLEL		0x011C
#define TKUCC_NMID_BRLE			0x011D
#define TKUCC_NMID_BRGTL		0x011E
#define TKUCC_NMID_BRGT			0x011F

#define TKUCC_NMID_BRLTL		0x0120
#define TKUCC_NMID_BRLT			0x0121
#define TKUCC_NMID_BRGEL		0x0122
#define TKUCC_NMID_BRGE			0x0123

#define TKUCC_NMID_JIMM			0x0124
#define TKUCC_NMID_JOP64		0x0125


#define TKUCC_FMID_REGREG4		0x01
#define TKUCC_FMID_REGST4		0x02
#define TKUCC_FMID_REGLD4		0x03
#define TKUCC_FMID_REGSTR0N		0x04
#define TKUCC_FMID_REGLDR0M		0x05
#define TKUCC_FMID_PCDISP8		0x06
#define TKUCC_FMID_IMM8			0x07
#define TKUCC_FMID_REGREG55A	0x08
#define TKUCC_FMID_NONE			0x09
#define TKUCC_FMID_REGLDSPVIMM4	0x0A
#define TKUCC_FMID_REGSTSPVIMM4	0x0B
#define TKUCC_FMID_REGVIMM4		0x0C
#define TKUCC_FMID_REGVIMM4_N	0x0D
#define TKUCC_FMID_REGRN4		0x0E
#define TKUCC_FMID_IMM5RN4		0x0F

#define TKUCC_FMID_REGR0REG4	0x10
#define TKUCC_FMID_REGIMM8S		0x11
#define TKUCC_FMID_REGSTDISP3	0x12
#define TKUCC_FMID_REGLDDISP3	0x13
#define TKUCC_FMID_IMM12A_U		0x14
#define TKUCC_FMID_IMM12A_N		0x15
#define TKUCC_FMID_REGKVIMM4_U	0x16
#define TKUCC_FMID_REGKVIMM4_N	0x17

#define TKUCC_FMID_REGSTDISP5	0x18
#define TKUCC_FMID_REGLDDISP5	0x19
#define TKUCC_FMID_REGSTRON		0x1A
#define TKUCC_FMID_REGLDROM		0x1B
#define TKUCC_FMID_REGREGREG	0x1C
#define TKUCC_FMID_REGREGB		0x1D
#define TKUCC_FMID_REGRON		0x1E
#define TKUCC_FMID_REGIMM5REG	0x1F

#define TKUCC_FMID_REGSTDISP		0x20
#define TKUCC_FMID_REGLDDISP		0x21
#define TKUCC_FMID_PCDISP20			0x22
#define TKUCC_FMID_REGIMMREG_8S		0x23
#define TKUCC_FMID_REGIMMREG		0x24
#define TKUCC_FMID_REGIMMREG_N		0x25
#define TKUCC_FMID_REGIMM_10		0x26
#define TKUCC_FMID_REGIMM_10_N		0x27
#define TKUCC_FMID_PCDISP8REG		0x28
#define TKUCC_FMID_REGLDGBRDISP10N	0x29
#define TKUCC_FMID_REGSTGBRDISP10	0x2A
#define TKUCC_FMID_REGLDGBRDISP10	0x2B
#define TKUCC_FMID_REGIMM16_U		0x2C
#define TKUCC_FMID_REGIMM16_N		0x2D
#define TKUCC_FMID_IMM24_U			0x2E
#define TKUCC_FMID_IMM24_N			0x2F

#define TKUCC_FMID_REGIMM16S		0x30


#define TKUCC_REG_R0				0x00
#define TKUCC_REG_R1				0x01
#define TKUCC_REG_R2				0x02
#define TKUCC_REG_R3				0x03
#define TKUCC_REG_R4				0x04
#define TKUCC_REG_R5				0x05
#define TKUCC_REG_R6				0x06
#define TKUCC_REG_R7				0x07
#define TKUCC_REG_R8				0x08
#define TKUCC_REG_R9				0x09
#define TKUCC_REG_R10				0x0A
#define TKUCC_REG_R11				0x0B
#define TKUCC_REG_R12				0x0C
#define TKUCC_REG_R13				0x0D
#define TKUCC_REG_R14				0x0E
#define TKUCC_REG_R15				0x0F
#define TKUCC_REG_R16				0x10
#define TKUCC_REG_R17				0x11
#define TKUCC_REG_R18				0x12
#define TKUCC_REG_R19				0x13
#define TKUCC_REG_R20				0x14
#define TKUCC_REG_R21				0x15
#define TKUCC_REG_R22				0x16
#define TKUCC_REG_R23				0x17
#define TKUCC_REG_R24				0x18
#define TKUCC_REG_R25				0x19
#define TKUCC_REG_R26				0x1A
#define TKUCC_REG_R27				0x1B
#define TKUCC_REG_R28				0x1C
#define TKUCC_REG_R29				0x1D
#define TKUCC_REG_R30				0x1E
#define TKUCC_REG_R31				0x1F

#define TKUCC_REG_R32				0x20
#define TKUCC_REG_R33				0x21
#define TKUCC_REG_R34				0x22
#define TKUCC_REG_R35				0x23
#define TKUCC_REG_R36				0x24
#define TKUCC_REG_R37				0x25
#define TKUCC_REG_R38				0x26
#define TKUCC_REG_R39				0x27
#define TKUCC_REG_R40				0x28
#define TKUCC_REG_R41				0x29
#define TKUCC_REG_R42				0x2A
#define TKUCC_REG_R43				0x2B
#define TKUCC_REG_R44				0x2C
#define TKUCC_REG_R45				0x2D
#define TKUCC_REG_R46				0x2E
#define TKUCC_REG_R47				0x2F

#define TKUCC_REG_R48				0x30
#define TKUCC_REG_R49				0x31
#define TKUCC_REG_R50				0x32
#define TKUCC_REG_R51				0x33
#define TKUCC_REG_R52				0x34
#define TKUCC_REG_R53				0x35
#define TKUCC_REG_R54				0x36
#define TKUCC_REG_R55				0x37
#define TKUCC_REG_R56				0x38
#define TKUCC_REG_R57				0x39
#define TKUCC_REG_R58				0x3A
#define TKUCC_REG_R59				0x3B
#define TKUCC_REG_R60				0x3C
#define TKUCC_REG_R61				0x3D
#define TKUCC_REG_R62				0x3E
#define TKUCC_REG_R63				0x3F


#define TKUCC_ARGTY_REG				0x01
#define TKUCC_ARGTY_IMM				0x02
#define TKUCC_ARGTY_LABEL			0x03

#define TKUCC_ARGTY_MEM_R			0x04
#define TKUCC_ARGTY_MEM_RD			0x05
#define TKUCC_ARGTY_MEM_RI			0x06

#define TKUCC_RELOC_DIR32				0x01	//Absolute 32-bit
#define TKUCC_RELOC_DIR64				0x02	//Absolute 64-bit

#define TKUCC_RELOC_JX2_RELW8S			0x04	//XXdd
#define TKUCC_RELOC_JX2_RELW20S			0x05	//XXdd-Xddd
#define TKUCC_RELOC_JX2_RELW24A			0x06	//FAdd-dddd


typedef struct TKUCC_LinkObjectLbl_s	TKUCC_LinkObjectLbl;
typedef struct TKUCC_LinkObjectSec_s	TKUCC_LinkObjectSec;
typedef struct TKUCC_LinkObject_s		TKUCC_LinkObject;

typedef struct TKUCC_AsmOpArg_s		TKUCC_AsmOpArg;
typedef struct TKUCC_AsmOp_s			TKUCC_AsmOp;

struct TKUCC_LinkObjectLbl_s {
u32 sym_name;
u32 sym_ofs;
byte sym_sec;
byte sym_type;
u16 pad0;
u32 lbl_id;
};

struct TKUCC_LinkObjectSec_s {
char *name;
byte **buf;
int ct_ofs;
int ct_size;
};

struct TKUCC_LinkObject_s {
TKUCC_LinkObjectSec *sec[16];
char n_sec;
char c_sec;

TKUCC_LinkObjectSec *strs;

TKUCC_LinkObjectLbl **lbl;
TKUCC_LinkObjectLbl **rlc;
int n_lbl, n_rlc;
};

struct TKUCC_AsmOpArg_s {
short rb;
short ri;
byte aty;
int lbl;
s64 imm;	//immed / disp
};

struct TKUCC_AsmOp_s {
short nmid;
short fmid;
byte n_arg;
byte pred;

TKUCC_AsmOpArg arg[4];
};